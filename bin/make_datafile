#!/usr/bin/python
#
# Grab a sweep of test runs and create a datafile from them
# that can be used as input to the visual_metrics data tool.
#
import argparse
import sys

# Library path relative to directory containing library.
sys.path.append('../vpx_codec_comparison/tweaker')

import encoder
import pick_codec

def main():
  parser = argparse.ArgumentParser()
  parser.add_argument('videofile')
  parser.add_argument('--codec')
  parser.add_argument('--config')
  parser.add_argument('--vary')
  args = parser.parse_args()
  codec = pick_codec.PickCodec(args.codec)
  my_encoder = encoder.Encoder(codec, filename=args.config)
  videofile = encoder.Videofile(args.videofile)

  encodings = []
  if args.vary == 'rate':
    encodings = my_encoder.AllScoredRates(videofile)
  else:
    encodings = my_encoder.AllScoredVariants(videofile, args.vary)

  print 'Bitrate PSNR'
  for encoding in encodings.encodings:
    print "%d %f" % (encoding.result['bitrate'], encoding.result['psnr'])

if __name__ == '__main__':
  sys.exit(main())
